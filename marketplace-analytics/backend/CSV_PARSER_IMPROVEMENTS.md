# –£–ª—É—á—à–µ–Ω–∏—è CSV –ü–∞—Ä—Å–µ—Ä–∞

## –ü—Ä–æ–±–ª–µ–º–∞

–í –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV —Ñ–∞–π–ª–æ–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ–¥–∞–∂ Ozon –±—ã–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º —Å—Ç—Ä–æ–∫, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö:
- –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –≤–Ω—É—Ç—Ä–∏ –ø–æ–ª–µ–π
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –≤ –æ–¥–Ω–æ–º –ø–æ–ª–µ

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```
10.09.2025,181276435,"–ö–Ω–∏–≥–∞ ""–ê—Ç–æ–º–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏"",29810,6,178860,31929,146931
09.09.2025,140272455,"–§–µ–Ω –¥–ª—è –≤–æ–ª–æ—Å Dyson",20469,9,184221,35702,148519
```

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–æ–ª—É—á–∞–ª–æ—Å—å:
- –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: `"–ö–Ω–∏–≥–∞ "–ê—Ç–æ–º–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏",29810,6,178860,31929,146931\n09.09.2025,140272455,"–§–µ–Ω –¥–ª—è –≤–æ–ª–æ—Å Dyson"`
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è: –ø—É—Å—Ç—ã–µ

## –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —É–ª—É—á—à–µ–Ω–Ω—ã–π CSV –ø–∞—Ä—Å–µ—Ä `ImprovedCSVParser` —Å —Å–ª–µ–¥—É—é—â–∏–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏:

### 1. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–≤—ã—á–µ–∫

```javascript
parseCSVLine(line) {
  const fields = [];
  let current = '';
  let inQuotes = false;
  let i = 0;
  
  while (i < line.length) {
    const char = line[i];
    const nextChar = line[i + 1];
    
    if (char === '"') {
      if (inQuotes) {
        if (nextChar === '"') {
          // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∞–≤—ã—á–∫–∞
          current += '"';
          i += 2;
          continue;
        } else {
          // –ö–æ–Ω–µ—Ü –ø–æ–ª—è –≤ –∫–∞–≤—ã—á–∫–∞—Ö
          inQuotes = false;
        }
      } else {
        // –ù–∞—á–∞–ª–æ –ø–æ–ª—è –≤ –∫–∞–≤—ã—á–∫–∞—Ö
        inQuotes = true;
      }
    } else if (char === ',' && !inQuotes) {
      // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –ø–æ–ª–µ–π
      fields.push(current.trim());
      current = '';
      i++;
      continue;
    } else {
      current += char;
    }
    i++;
  }
  
  fields.push(current.trim());
  return fields;
}
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫

```javascript
repairCSVLine(line, expectedFields) {
  // –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫
  if (line.includes('\n')) {
    return this.splitMultipleRows(line, expectedFields);
  }
  
  // –ü–æ–∏—Å–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  const dataPattern = /^(.+?),(\d+),(\d+),(\d+),(\d+),(\d+)$/;
  const match = field.match(dataPattern);
  if (match) {
    const cleanName = match[1].replace(/"/g, '');
    fields.splice(i, 1, cleanName, match[2], match[3], match[4], match[5], match[6]);
  }
}
```

### 3. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫

```javascript
splitMultipleRows(combinedLine, expectedFields) {
  // –ü–æ–∏—Å–∫ –¥–∞—Ç –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫
  const datePattern = /(\d{2}\.\d{2}\.\d{4})/g;
  const dates = [];
  
  // –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–∞—Ç–∞–º –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  // ...
}
```

### 4. –û—á–∏—Å—Ç–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤

```javascript
cleanProductName(name) {
  if (!name) return '';
  let cleaned = name.replace(/^""|""$/g, '').replace(/""/g, '"');
  cleaned = cleaned.replace(/,\d+,\d+,[\d,]+$/g, '');
  cleaned = cleaned.replace(/\n/g, ' ').replace(/\s+/g, ' ').trim();
  return cleaned;
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–π —Ñ–∞–π–ª (–¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 3 —Å—Ç—Ä–æ–∫–∏, 1 –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–∞—è
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Å–æ–¥–µ—Ä–∂–∞–ª–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–æ–∫

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–π —Ñ–∞–π–ª (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 3 —Å—Ç—Ä–æ–∫–∏, –≤—Å–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ**: "–ö–Ω–∏–≥–∞ –ê—Ç–æ–º–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏" —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–∞–π–ª (50 —Å—Ç—Ä–æ–∫)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 50/50 —Å—Ç—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ü–∞—Ä—Å–µ—Ä –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤:
- `manual-file-processing.js` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
- `improved-csv-parser.js` - –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å Prisma
- `test-improved-processing.js` - —Ç–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```javascript
const csvParser = new ImprovedCSVParser();
const parsed = csvParser.parseCSV(fileContent);

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
for (const row of parsed.data) {
  const productName = csvParser.cleanProductName(row['–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞']);
  // ... –¥–∞–ª—å–Ω–µ–π—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ü–∞—Ä—Å–µ—Ä —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
2. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ CSV —Ñ–∞–π–ª–∞–º–∏
3. **–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
4. **–ì–∏–±–∫–æ—Å—Ç—å**: –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –ø—Ä–æ–±–ª–µ–º

## –õ–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

```
‚ö†Ô∏è –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª–µ–π: –æ–∂–∏–¥–∞–ª–æ—Å—å 8, –ø–æ–ª—É—á–µ–Ω–æ 3
üîß –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏...
üìù –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ - —Ä–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
üîÄ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏
üéØ –†–∞–∑–¥–µ–ª—è–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–µ –ø–æ–ª–µ –≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
‚úÖ –°—Ç—Ä–æ–∫–∞ —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
```

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è Excel, TSV
2. **–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è**: –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏