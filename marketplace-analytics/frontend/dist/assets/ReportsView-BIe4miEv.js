import{b as r,o as i,e as t,d as ue,a as n,c as b,x as ce,f as a,w as p,i as v,C as W,n as D,B as Z,E as ve,h as C,F as P,y as me,t as o,k,p as V,z as pe,j as fe,A as H,l as xe}from"./index-VpZQxTwI.js";import{u as z,_ as ge}from"./FileUpload.vue_vue_type_script_setup_true_lang-DWBaF2s6.js";import{_ as m}from"./BaseButton.vue_vue_type_script_setup_true_lang-RCuHMJ8G.js";import{r as ye,a as T,_ as be,b as q,c as ke}from"./ConfirmationModal.vue_vue_type_script_setup_true_lang-CK9t_sTQ.js";import{r as we}from"./EyeIcon-CKpIxSL3.js";import"./ExclamationTriangleIcon-14f6j3RX.js";function _e(A,y){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function Re(A,y){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{d:"M11.625 16.5a1.875 1.875 0 1 0 0-3.75 1.875 1.875 0 0 0 0 3.75Z"}),t("path",{"fill-rule":"evenodd",d:"M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6 16.5c.66 0 1.277-.19 1.797-.518l1.048 1.048a.75.75 0 0 0 1.06-1.06l-1.047-1.048A3.375 3.375 0 1 0 11.625 18Z","clip-rule":"evenodd"}),t("path",{d:"M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z"})])}const Ce={class:"space-y-6"},he={class:"border-b border-gray-200 pb-5"},$e={class:"flex items-center justify-between"},De={class:"flex items-center space-x-3"},Ve={class:"flex items-center justify-between"},Ee={class:"flex items-center space-x-4"},Fe={class:"flex items-center space-x-2"},Me={key:0,class:"flex justify-center items-center h-64"},Ue={key:1,class:"text-center py-12"},ze={class:"mt-6"},Ne={key:2,class:"text-center py-12"},Be={class:"mt-6"},Se={key:3,class:"space-y-4"},Ie={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3"},Ae=["onClick"],Le={class:"card-body"},je={class:"flex items-start justify-between mb-4"},Oe={class:"flex-1"},We={class:"flex items-center space-x-2 mb-2"},Ze=["title"],Pe={class:"space-y-3"},He={class:"grid grid-cols-2 gap-4 text-sm"},Te={class:"font-medium"},qe={class:"flex items-center space-x-1"},Qe={key:0,class:"pt-2 border-t border-gray-200"},Ge={class:"grid grid-cols-2 gap-4 text-sm"},Je={key:0},Ke={class:"font-medium text-blue-600"},Xe={key:1},Ye={key:0,class:"mt-2 text-sm"},et={class:"pt-2 border-t border-gray-200 text-xs text-gray-500"},tt={key:0,class:"card"},st={class:"card-body"},lt={class:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-5"},at={class:"text-center"},ot={class:"text-2xl font-bold text-blue-600"},rt={class:"text-center"},it={class:"text-2xl font-bold text-green-600"},nt={class:"text-center"},dt={class:"text-2xl font-bold text-yellow-600"},ut={class:"text-center"},ct={class:"text-2xl font-bold text-purple-600"},vt={class:"text-center"},mt={class:"text-2xl font-bold text-indigo-600"},pt={class:"space-y-4"},ft={class:"text-sm text-gray-600 mb-4"},xt={class:"mt-2 space-y-2"},gt={class:"flex items-center"},yt={class:"flex items-center"},bt={class:"mt-4"},kt={key:0,class:"mt-2 text-sm text-red-600"},wt={class:"flex justify-end space-x-3"},Vt=ue({__name:"ReportsView",setup(A){xe();const y=n([]),w=n(!1),c=n(null),d=n({marketplace:"",processed:""}),_=n(""),E=n(!1),f=n(""),h=n([]),x=n(""),F=n(!1),N=n(),M=n(!1),U=n(!1),L=b(()=>d.value.marketplace||d.value.processed||_.value),g=b(()=>{let s=[...y.value];if(d.value.marketplace&&(s=s.filter(e=>e.marketplace===d.value.marketplace)),d.value.processed){const e=d.value.processed==="true";s=s.filter(u=>u.processed===e)}if(_.value){const e=_.value.toLowerCase();s=s.filter(u=>u.fileName.toLowerCase().includes(e))}return s}),Q=b(()=>g.value.filter(s=>s.processed).length),G=b(()=>g.value.filter(s=>!s.processed).length),J=b(()=>g.value.reduce((s,e)=>{var u;return s+(((u=e._count)==null?void 0:u.salesData)||0)},0)),K=b(()=>g.value.reduce((s,e)=>s+(e.totalRevenue||0),0)),j=b(()=>f.value&&h.value.length>0&&!F.value),$=async()=>{try{w.value=!0,y.value=await z.getReports()}catch(s){console.error("Error loading reports:",s)}finally{w.value=!1}},B=()=>{},X=()=>{d.value={marketplace:"",processed:""},_.value=""},Y=s=>s==="WILDBERRIES"?"Wildberries":"Ozon",ee=s=>s==="WILDBERRIES"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800",te=s=>new Date(s).toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),S=s=>new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),se=s=>{c.value=s,M.value=!0},le=()=>{U.value=!0},ae=async()=>{if(c.value)try{await z.deleteReport(c.value.id),await $(),M.value=!1,c.value=null}catch(s){console.error("Error deleting report:",s)}},oe=async()=>{try{await z.deleteAllReports(),await $(),U.value=!1}catch(s){console.error("Error deleting all reports:",s)}},re=s=>{c.value=s,f.value=s.marketplace,h.value=[],x.value="",E.value=!0},O=()=>{E.value=!1,c.value=null,f.value="",h.value=[],x.value="",N.value&&N.value.clearFiles()},ie=s=>{h.value=s,x.value=""},ne=s=>{x.value=s},de=async()=>{var s,e;if(!(!j.value||!c.value))try{F.value=!0,x.value="",await z.replaceReport(c.value.id,h.value[0],f.value),await $(),O()}catch(u){x.value=((e=(s=u.response)==null?void 0:s.data)==null?void 0:e.message)||"Произошла ошибка при замене файла"}finally{F.value=!1}};return ce(()=>{$()}),(s,e)=>{var u;return i(),r(P,null,[t("div",Ce,[t("div",he,[t("div",$e,[e[14]||(e[14]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900"},"Отчеты"),t("p",{class:"mt-1 text-sm text-gray-600"}," Управление загруженными отчетами и их анализ ")],-1)),t("div",De,[a(m,{variant:"outline",icon:v(ye),onClick:$,loading:w.value},{default:p(()=>[...e[11]||(e[11]=[k(" Обновить ",-1)])]),_:1},8,["icon","loading"]),a(m,{variant:"primary",icon:v(W),onClick:e[0]||(e[0]=l=>s.$router.push("/upload"))},{default:p(()=>[...e[12]||(e[12]=[k(" Загрузить отчет ",-1)])]),_:1},8,["icon"]),a(m,{variant:"danger",icon:v(T),onClick:le,disabled:y.value.length===0},{default:p(()=>[...e[13]||(e[13]=[k(" Очистить все ",-1)])]),_:1},8,["icon","disabled"])])])]),t("div",Ve,[t("div",Ee,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Маркетплейс",-1)),D(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>d.value.marketplace=l),onChange:B,class:"form-input"},[...e[15]||(e[15]=[t("option",{value:""},"Все маркетплейсы",-1),t("option",{value:"WILDBERRIES"},"Wildberries",-1),t("option",{value:"OZON"},"Ozon",-1)])],544),[[Z,d.value.marketplace]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Статус",-1)),D(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>d.value.processed=l),onChange:B,class:"form-input"},[...e[17]||(e[17]=[t("option",{value:""},"Все статусы",-1),t("option",{value:"true"},"Обработан",-1),t("option",{value:"false"},"В обработке",-1)])],544),[[Z,d.value.processed]])])]),t("div",Fe,[a(v(_e),{class:"h-5 w-5 text-gray-400"}),D(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>_.value=l),onInput:B,type:"text",placeholder:"Поиск по названию файла...",class:"form-input"},null,544),[[ve,_.value]])])]),w.value&&y.value.length===0?(i(),r("div",Me,[...e[19]||(e[19]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1)])])):!w.value&&y.value.length===0&&!L.value?(i(),r("div",Ue,[a(v(W),{class:"mx-auto h-12 w-12 text-gray-400"}),e[21]||(e[21]=t("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Нет отчетов",-1)),e[22]||(e[22]=t("p",{class:"mt-1 text-sm text-gray-500"}," Загрузите первый отчет для начала работы с аналитикой ",-1)),t("div",ze,[a(m,{variant:"primary",onClick:e[4]||(e[4]=l=>s.$router.push("/upload"))},{default:p(()=>[...e[20]||(e[20]=[k(" Загрузить файл ",-1)])]),_:1})])])):!w.value&&g.value.length===0&&L.value?(i(),r("div",Ne,[a(v(Re),{class:"mx-auto h-12 w-12 text-gray-400"}),e[24]||(e[24]=t("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Нет результатов",-1)),e[25]||(e[25]=t("p",{class:"mt-1 text-sm text-gray-500"}," Попробуйте изменить параметры поиска или фильтры ",-1)),t("div",Be,[a(m,{variant:"outline",onClick:X},{default:p(()=>[...e[23]||(e[23]=[k(" Очистить фильтры ",-1)])]),_:1})])])):(i(),r("div",Se,[t("div",Ie,[(i(!0),r(P,null,me(g.value,l=>{var R;return i(),r("div",{key:l.id,class:"card hover:shadow-lg transition-shadow cursor-pointer",onClick:I=>s.$router.push(`/reports/${l.id}`)},[t("div",Le,[t("div",je,[t("div",Oe,[t("div",We,[a(v(pe),{class:V(["h-6 w-6",l.processed?"text-green-500":"text-yellow-500"])},null,8,["class"]),t("span",{class:V(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",ee(l.marketplace)])},o(Y(l.marketplace)),3)]),t("h3",{class:"text-sm font-medium text-gray-900 truncate",title:l.fileName},o(l.fileName),9,Ze)]),t("div",{class:"flex items-center space-x-1",onClick:e[5]||(e[5]=fe(()=>{},["stop"]))},[a(m,{variant:"outline",size:"sm",icon:v(we),onClick:I=>s.$router.push(`/reports/${l.id}`),title:"Просмотреть"},null,8,["icon","onClick"]),a(m,{variant:"outline",size:"sm",icon:v(ke),onClick:I=>re(l),title:"Заменить"},null,8,["icon","onClick"]),a(m,{variant:"danger",size:"sm",icon:v(T),onClick:I=>se(l),title:"Удалить"},null,8,["icon","onClick"])])]),t("div",Pe,[t("div",He,[t("div",null,[e[26]||(e[26]=t("div",{class:"text-gray-500"},"Записей",-1)),t("div",Te,o(((R=l._count)==null?void 0:R.salesData)||0),1)]),t("div",null,[e[27]||(e[27]=t("div",{class:"text-gray-500"},"Статус",-1)),t("div",qe,[t("div",{class:V(["w-2 h-2 rounded-full",l.processed?"bg-green-500":"bg-yellow-500"])},null,2),t("span",null,o(l.processed?"Обработан":"В обработке"),1)])])]),l.totalRevenue||l.totalProfit?(i(),r("div",Qe,[t("div",Ge,[l.totalRevenue?(i(),r("div",Je,[e[28]||(e[28]=t("div",{class:"text-gray-500"},"Выручка",-1)),t("div",Ke,o(S(l.totalRevenue)),1)])):C("",!0),l.totalProfit?(i(),r("div",Xe,[e[29]||(e[29]=t("div",{class:"text-gray-500"},"Прибыль",-1)),t("div",{class:V(["font-medium",l.totalProfit>=0?"text-green-600":"text-red-600"])},o(S(l.totalProfit)),3)])):C("",!0)]),l.profitMargin?(i(),r("div",Ye,[e[30]||(e[30]=t("div",{class:"text-gray-500"},"Маржинальность",-1)),t("div",{class:V(["font-medium",l.profitMargin>=0?"text-green-600":"text-red-600"])},o(l.profitMargin.toFixed(1))+"% ",3)])):C("",!0)])):C("",!0),t("div",et," Загружен: "+o(te(l.uploadDate)),1)])])],8,Ae)}),128))]),g.value.length>0?(i(),r("div",tt,[e[36]||(e[36]=t("div",{class:"card-header"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Сводка по отчетам")],-1)),t("div",st,[t("div",lt,[t("div",at,[t("div",ot,o(g.value.length),1),e[31]||(e[31]=t("div",{class:"text-sm text-gray-500"},"Всего отчетов",-1))]),t("div",rt,[t("div",it,o(Q.value),1),e[32]||(e[32]=t("div",{class:"text-sm text-gray-500"},"Обработано",-1))]),t("div",nt,[t("div",dt,o(G.value),1),e[33]||(e[33]=t("div",{class:"text-sm text-gray-500"},"В обработке",-1))]),t("div",ut,[t("div",ct,o(J.value),1),e[34]||(e[34]=t("div",{class:"text-sm text-gray-500"},"Записей продаж",-1))]),t("div",vt,[t("div",mt,o(S(K.value)),1),e[35]||(e[35]=t("div",{class:"text-sm text-gray-500"},"Общая выручка",-1))])])])])):C("",!0)]))]),a(be,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=l=>E.value=l),title:"Заменить отчет",size:"md"},{footer:p(()=>[t("div",wt,[a(m,{variant:"outline",onClick:O},{default:p(()=>[...e[41]||(e[41]=[k(" Отмена ",-1)])]),_:1}),a(m,{variant:"primary",onClick:de,loading:F.value,disabled:!j.value},{default:p(()=>[...e[42]||(e[42]=[k(" Заменить ",-1)])]),_:1},8,["loading","disabled"])])]),default:p(()=>{var l;return[t("div",pt,[t("div",null,[t("p",ft,' Заменить отчет "'+o((l=c.value)==null?void 0:l.fileName)+'" новым файлом? ',1),t("div",null,[e[39]||(e[39]=t("label",{class:"form-label"},"Маркетплейс",-1)),t("div",xt,[t("div",gt,[D(t("input",{id:"replace-wildberries","onUpdate:modelValue":e[6]||(e[6]=R=>f.value=R),name:"marketplace",type:"radio",value:"WILDBERRIES",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"},null,512),[[H,f.value]]),e[37]||(e[37]=t("label",{for:"replace-wildberries",class:"ml-3 block text-sm font-medium text-gray-700"}," Wildberries ",-1))]),t("div",yt,[D(t("input",{id:"replace-ozon","onUpdate:modelValue":e[7]||(e[7]=R=>f.value=R),name:"marketplace",type:"radio",value:"OZON",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"},null,512),[[H,f.value]]),e[38]||(e[38]=t("label",{for:"replace-ozon",class:"ml-3 block text-sm font-medium text-gray-700"}," Ozon ",-1))])])]),t("div",bt,[e[40]||(e[40]=t("label",{class:"form-label"},"Новый файл",-1)),a(ge,{ref_key:"replaceFileUploadRef",ref:N,accept:".xlsx,.xls,.csv","max-size":52428800,onFilesSelected:ie,onError:ne},null,512)]),x.value?(i(),r("div",kt,o(x.value),1)):C("",!0)])])]}),_:1},8,["modelValue"]),a(q,{modelValue:M.value,"onUpdate:modelValue":e[9]||(e[9]=l=>M.value=l),title:"Удалить отчет",message:`Вы уверены, что хотите удалить отчет '${(u=c.value)==null?void 0:u.fileName}'? Это действие нельзя отменить.`,"confirm-text":"Удалить","confirm-variant":"danger",onConfirm:ae},null,8,["modelValue","message"]),a(q,{modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=l=>U.value=l),title:"Удалить все отчеты",message:"Вы уверены, что хотите удалить ВСЕ отчеты? Это действие нельзя отменить и приведет к потере всех данных.","confirm-text":"Удалить все","confirm-variant":"danger",onConfirm:oe},null,8,["modelValue"])],64)}}});export{Vt as default};
//# sourceMappingURL=ReportsView-BIe4miEv.js.map
